<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Conway's Game of Life</title>
    <script src="./jquery-2.0.3.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="./d3.v3.min.js"></script>
    <style type="text/css" media="all">
      html {
        height: 100%;
      }
      body {
        height: 100%;
        margin: 0 auto;
      }
      rect.live {
        fill: slategrey;
      }
      rect.dead {
        stroke: #70DBD1;
        stroke-width: 0.1;
        fill: transparent;
      }
    </style>
  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      var GliderSeed = [
        {Row: 2, Col: 1},
        {Row: 2, Col: 2},
        {Row: 2, Col: 3},
        {Row: 1, Col: 3},
        {Row: 0, Col: 2}
      ];

      var GosperGliderGun = [
        {Row: 5, Col: 1},
        {Row: 5, Col: 2},
        {Row: 6, Col: 1},
        {Row: 6, Col: 2},
        {Row: 3, Col: 13},
        {Row: 3, Col: 14},
        {Row: 4, Col: 12},
        {Row: 4, Col: 16},
        {Row: 5, Col: 11},
        {Row: 5, Col: 17},
        {Row: 6, Col: 11},
        {Row: 6, Col: 15},
        {Row: 6, Col: 17},
        {Row: 6, Col: 18},
        {Row: 7, Col: 11},
        {Row: 7, Col: 17},
        {Row: 8, Col: 12},
        {Row: 8, Col: 16},
        {Row: 9, Col: 13},
        {Row: 9, Col: 14},
        {Row: 1, Col: 25},
        {Row: 2, Col: 23},
        {Row: 2, Col: 25},
        {Row: 3, Col: 21},
        {Row: 3, Col: 22},
        {Row: 4, Col: 21},
        {Row: 4, Col: 22},
        {Row: 5, Col: 21},
        {Row: 5, Col: 22},
        {Row: 6, Col: 23},
        {Row: 6, Col: 25},
        {Row: 7, Col: 25},
        {Row: 3, Col: 35},
        {Row: 3, Col: 36},
        {Row: 4, Col: 35},
        {Row: 4, Col: 36}
      ];

      var diehard = [
        {Row: 50, Col: 50},
        {Row: 50, Col: 51},
        {Row: 51, Col: 51},
        {Row: 49, Col: 56},
        {Row: 51, Col: 55},
        {Row: 51, Col: 56},
        {Row: 51, Col: 57},
      ];

      var beacon = [
        {Row: 40, Col: 40},
        {Row: 40, Col: 41},
        {Row: 41, Col: 40},
        {Row: 43, Col: 42},
        {Row: 43, Col: 43},
        {Row: 42, Col: 43},
      ];

      var current_generation = GosperGliderGun;

      $(function() {
          var width = 960,
            height = 600
            cell_size = 10;

          var grid = [];
          // XXX Why swapping two fors fucks things up???
          for (var y = 0, my = height / cell_size; y < my; y++) {
            for (var x = 0, mx = width / cell_size; x < mx; x++) {
              grid.push({Row: y, Col: x});
            }
          }

          var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height);

          svg.selectAll('rect').data(grid)
            .enter().append('rect')
            .attr('width', cell_size)
            .attr('height', cell_size)
            .attr('class', 'dead')
            .attr('x', function(d) { return d.Col * cell_size })
            .attr('y', function(d) { return d.Row * cell_size })

          var gameRound = function() {
            $.post("/go", JSON.stringify(current_generation), renderNextGeneration);
          };

          var renderNextGeneration = function(data) {
            var rect = svg.selectAll('rect').data(data, function(d) {
              return String(d.Row) + String(d.Col);
            });

            rect.attr('class', 'live')

            rect.exit().attr('class', 'dead')

            current_generation = data;
          };

          setInterval(gameRound, 100);

      })
    </script>

    <!-- <select id="seed"> -->
    <!--   <option value="glider" selected>Glider</option> -->
    <!--   <option value="gospers_glider_gun">Gosper's Glider Gun</option> -->
    <!--   <option value="diehard">Diehard</option> -->
    <!--   <option value="beacon">Beacon</option> -->
    <!-- </select> -->
  </body>
</html>
